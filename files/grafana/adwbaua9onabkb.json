{"meta":{"type":"db","canSave":false,"canEdit":false,"canAdmin":false,"canStar":true,"canDelete":false,"slug":"okr1-controle-dos-gastos","url":"/d/adwbaua9onabkb/okr1-controle-dos-gastos","expires":"0001-01-01T00:00:00Z","created":"2024-08-29T18:37:48Z","updated":"2024-09-01T21:10:48Z","updatedBy":"admin","createdBy":"admin","version":6,"hasAcl":false,"isFolder":false,"folderId":3,"folderUid":"bdwbas55zz5z4b","folderTitle":"Banky","folderUrl":"/dashboards/f/bdwbas55zz5z4b/banky","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":false,"canEdit":false,"canDelete":false},"organization":{"canAdd":false,"canEdit":false,"canDelete":false}}},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"description":"OKR 1: Entender onde há um maior gasto\nObjective: Identificar e entender as principais categorias de despesas pessoais.\n----------------------------------------------------------------\nKey Results:\n\n1. Rastrear todas as despesas diárias por 3 meses.\n2. Categorizar todas as despesas em pelo menos 5 categorias principais.\n3. Analisar o histórico de despesas para identificar as 3 maiores categorias de gasto.\n4. Reduzir os gastos em pelo menos uma das três maiores categorias em 10% até o final do trimestre.\n5. Criar um relatório mensal detalhado das despesas.\n\n----------------------------------------------------------------\nKPIs:\n\n1. Percentual de despesas rastreadas mensalmente.\n2. Número de categorias de despesas identificadas.\n3. Percentual de redução nos gastos nas categorias principais.\n4. Frequência de análise e relatório de despesas (mensalmente).\n5. Valor total das despesas mensais em comparação com meses anteriores.\n","editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":4,"links":[],"panels":[{"datasource":{"type":"mysql","uid":"fduch7oogb280e"},"description":"Total de meses gerenciando os gastos","fieldConfig":{"defaults":{"color":{"fixedColor":"#8a2be2","mode":"fixed"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":4,"w":5,"x":0,"y":0},"id":1,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"dataset":"u766359255_rod","datasource":{"type":"mysql","uid":"fduch7oogb280e"},"editorMode":"code","format":"table","rawQuery":true,"rawSql":"SELECT\r\n  COUNT(DISTINCT DATE_FORMAT(created_at, '%Y-%m')) AS number_of_months\r\nFROM\r\n  bk_tb_transactions;","refId":"A","sql":{"columns":[{"parameters":[{"name":"description","type":"functionParameter"}],"type":"function"}],"groupBy":[{"property":{"type":"string"},"type":"groupBy"}],"limit":50},"table":"bk_tb_transactions"}],"title":"Total Meses","type":"stat"},{"datasource":{"type":"mysql","uid":"fduch7oogb280e"},"description":"Valor gasto por mê e comparativo com mês anterior","fieldConfig":{"defaults":{"color":{"fixedColor":"#8a2be2","mode":"shades"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"currencyBRL"},"overrides":[]},"gridPos":{"h":4,"w":4,"x":5,"y":0},"id":6,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"inverted","reduceOptions":{"calcs":["lastNotNull"],"fields":"/^ammount$/","values":false},"showPercentChange":true,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"dataset":"u766359255_rod","datasource":{"type":"mysql","uid":"fduch7oogb280e"},"editorMode":"code","format":"table","rawQuery":true,"rawSql":"SELECT\r\n  sum(A.value) as ammount,\r\n  month(A.date) as month\r\nFROM\r\n  bk_tb_transactions A\r\n  join bk_tb_categories B on A.category = B.id\r\nwhere\r\n  B.positive is false\r\n  and B.internal is false\r\nGROUP BY\r\n  month(A.date)","refId":"A","sql":{"columns":[{"parameters":[],"type":"function"}],"groupBy":[{"property":{"type":"string"},"type":"groupBy"}],"limit":50}}],"title":"Gastos por mês","type":"stat"},{"datasource":{"type":"mysql","uid":"fduch7oogb280e"},"description":"Top 3 maiores gastos por mês","fieldConfig":{"defaults":{"color":{"fixedColor":"#8a2be2","mode":"shades"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","fillOpacity":80,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":1,"scaleDistribution":{"type":"linear"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"currencyBRL"},"overrides":[]},"gridPos":{"h":7,"w":15,"x":9,"y":0},"id":4,"options":{"barRadius":0,"barWidth":0.97,"fullHighlight":false,"groupWidth":0.7,"legend":{"calcs":[],"displayMode":"list","placement":"right","showLegend":false},"orientation":"auto","showValue":"auto","stacking":"none","tooltip":{"mode":"single","sort":"none"},"xField":"month","xTickLabelRotation":0,"xTickLabelSpacing":0},"targets":[{"dataset":"u766359255_rod","datasource":{"type":"mysql","uid":"fduch7oogb280e"},"editorMode":"code","format":"table","rawQuery":true,"rawSql":"WITH\r\n  QuarterlyCategorySpend AS (\r\n    SELECT\r\n      A.category,\r\n      CONCAT(YEAR(A.date), '-', MONTH(A.date)) AS month,\r\n      SUM(A.value) AS total_spent,\r\n      ROW_NUMBER() OVER (\r\n        PARTITION BY\r\n          YEAR(A.date),\r\n          MONTH(A.date)\r\n        ORDER BY\r\n          SUM(A.value) DESC\r\n      ) AS rank\r\n    FROM\r\n      bk_tb_transactions A\r\n      join bk_tb_categories D on A.category = D.id\r\n    where\r\n      D.internal is false\r\n      and D.positive is false\r\n    GROUP BY\r\n      A.category,\r\n      YEAR(A.date),\r\n      MONTH(A.date)\r\n  )\r\nSELECT\r\n  B.month,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 1 THEN C.name\r\n    END\r\n  ) AS cat1,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 1 THEN B.total_spent\r\n    END\r\n  ) AS cat_value1,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 2 THEN C.name\r\n    END\r\n  ) AS cat2,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 2 THEN B.total_spent\r\n    END\r\n  ) AS cat_value2,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 3 THEN C.name\r\n    END\r\n  ) AS cat3,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 3 THEN B.total_spent\r\n    END\r\n  ) AS cat_value3\r\nFROM\r\n  QuarterlyCategorySpend B\r\n  join bk_tb_categories C on B.category = C.id\r\nWHERE\r\n  B.rank <= 3\r\nGROUP BY\r\n  B.month\r\nORDER BY\r\n  B.month;","refId":"A","sql":{"columns":[{"parameters":[],"type":"function"}],"groupBy":[{"property":{"type":"string"},"type":"groupBy"}],"limit":50}}],"title":"3º Gastos/Mês","type":"barchart"},{"datasource":{"type":"mysql","uid":"fduch7oogb280e"},"description":"Top 5 categorias de gastos","fieldConfig":{"defaults":{"color":{"fixedColor":"#8a2be2","mode":"shades"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"mappings":[],"unit":"currencyBRL"},"overrides":[]},"gridPos":{"h":8,"w":5,"x":0,"y":4},"id":5,"options":{"displayLabels":["percent"],"legend":{"calcs":[],"displayMode":"list","placement":"right","showLegend":false,"values":[]},"pieType":"donut","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"11.1.3","targets":[{"dataset":"u766359255_rod","datasource":{"type":"mysql","uid":"fduch7oogb280e"},"editorMode":"code","format":"table","rawQuery":true,"rawSql":"SELECT\r\n  SUM(A.value) AS TOTAL,\r\n  B.name\r\nFROM\r\n  bk_tb_transactions A\r\n  JOIN bk_tb_categories B ON A.category = B.id\r\nWHERE\r\n  B.positive IS FALSE\r\n  AND B.internal IS FALSE\r\nGROUP BY\r\n  A.category\r\nORDER BY\r\n  TOTAL DESC\r\nLIMIT\r\n  5","refId":"A","sql":{"columns":[{"parameters":[],"type":"function"}],"groupBy":[{"property":{"type":"string"},"type":"groupBy"}],"limit":50}}],"title":"5º Gasto/Categorias","type":"piechart"},{"datasource":{"type":"mysql","uid":"fduch7oogb280e"},"fieldConfig":{"defaults":{"color":{"fixedColor":"#8a2be2","mode":"shades"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":4,"w":4,"x":5,"y":4},"id":2,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"/^transactions$/","values":false},"showPercentChange":true,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"dataset":"u766359255_rod","datasource":{"type":"mysql","uid":"fduch7oogb280e"},"editorMode":"code","format":"table","rawQuery":true,"rawSql":"SELECT count(A.id) as transactions\r\n     , month(A.date) as month\r\n  FROM bk_tb_transactions A\r\n--  WHERE A.date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)\r\n GROUP BY month(A.date)\r\n","refId":"A","sql":{"columns":[{"parameters":[],"type":"function"}],"groupBy":[{"property":{"type":"string"},"type":"groupBy"}],"limit":50}}],"title":"Transações por mês","type":"stat"},{"datasource":{"type":"mysql","uid":"fduch7oogb280e"},"description":"Top 3 categorias por trimestre com comparativo de redução","fieldConfig":{"defaults":{"color":{"fixedColor":"#8a2be2","mode":"shades"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","fillOpacity":80,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":1,"scaleDistribution":{"type":"linear"},"thresholdsStyle":{"mode":"off"}},"fieldMinMax":false,"mappings":[],"thresholds":{"mode":"percentage","steps":[{"color":"green","value":null}]},"unit":"currencyBRL"},"overrides":[{"matcher":{"id":"byRegexp","options":"/Percentual de redução/"},"properties":[{"id":"unit","value":"percent"}]}]},"gridPos":{"h":9,"w":15,"x":9,"y":7},"id":7,"options":{"barRadius":0,"barWidth":0.97,"fullHighlight":false,"groupWidth":0.7,"legend":{"calcs":[],"displayMode":"list","placement":"right","showLegend":true},"orientation":"auto","showValue":"auto","stacking":"normal","tooltip":{"mode":"single","sort":"none"},"xField":"categoria","xTickLabelMaxLength":15,"xTickLabelRotation":45,"xTickLabelSpacing":0},"targets":[{"dataset":"u766359255_rod","datasource":{"type":"mysql","uid":"fduch7oogb280e"},"editorMode":"code","format":"table","rawQuery":true,"rawSql":"WITH\r\n  QuarterlyCategorySpend AS (\r\n    SELECT\r\n      A.category,\r\n      CONCAT('T', QUARTER(date), '-', YEAR(date)) AS quarter,\r\n      SUM(value) AS total_spent,\r\n      ROW_NUMBER() OVER (\r\n        PARTITION BY\r\n          YEAR(A.date),\r\n          QUARTER(A.date)\r\n        ORDER BY\r\n          SUM(value) DESC\r\n      ) AS rank\r\n    FROM\r\n      bk_tb_transactions A \r\n    join bk_tb_categories B on A.category = B.id\r\n    where B.positive is false and B.internal is false\r\n    GROUP BY\r\n      A.category,\r\n      YEAR(A.date),\r\n      QUARTER(A.date)\r\n  ),\r\n  Top3Categories AS (\r\n    SELECT\r\n      quarter,\r\n      category,\r\n      total_spent,\r\n      rank,\r\n      LAG(total_spent) OVER (\r\n        PARTITION BY\r\n          category\r\n        ORDER BY\r\n          quarter\r\n      ) AS prev_total_spent\r\n    FROM\r\n      QuarterlyCategorySpend\r\n    WHERE\r\n      rank <= 3\r\n  )\r\nSELECT\r\n  A.quarter as trimestre,\r\n  A.category,\r\n  B.name as categoria,\r\n  A.total_spent as 'Valor gasto' ,\r\n  A.prev_total_spent as 'Valor ganto anterior',\r\n  CASE\r\n    WHEN A.prev_total_spent IS NOT NULL THEN (\r\n      (A.prev_total_spent - A.total_spent) / A.prev_total_spent\r\n    ) * 100\r\n    ELSE NULL\r\n  END AS 'Percentual de redução'\r\nFROM\r\n  Top3Categories A\r\n  join bk_tb_categories B on A.category = B.id\r\nORDER BY\r\n  A.quarter,\r\n  A.rank;","refId":"A","sql":{"columns":[{"parameters":[],"type":"function"}],"groupBy":[{"property":{"type":"string"},"type":"groupBy"}],"limit":50}}],"title":"3° gastos com redução","type":"barchart"},{"datasource":{"type":"mysql","uid":"fduch7oogb280e"},"description":"Total de categorias registradas no mês","fieldConfig":{"defaults":{"color":{"fixedColor":"#8a2be2","mode":"shades"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":4,"x":5,"y":8},"id":8,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"inverted","reduceOptions":{"calcs":["lastNotNull"],"fields":"/^categories$/","values":false},"showPercentChange":true,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"dataset":"u766359255_rod","datasource":{"type":"mysql","uid":"fduch7oogb280e"},"editorMode":"code","format":"table","rawQuery":true,"rawSql":"SELECT\r\n  count(A.category) as categories,\r\n  month(A.date) as month\r\nFROM\r\n  bk_tb_transactions A\r\n  join bk_tb_categories B on A.category = B.id\r\nwhere\r\n  B.positive is false\r\n  and B.internal is false\r\nGROUP BY\r\n  month(A.date)","refId":"A","sql":{"columns":[{"parameters":[],"type":"function"}],"groupBy":[{"property":{"type":"string"},"type":"groupBy"}],"limit":50}}],"title":"Categorias registradas","type":"stat"},{"datasource":{"type":"mysql","uid":"fduch7oogb280e"},"description":"Top3 categorias com maior gasto por trimestre","fieldConfig":{"defaults":{"color":{"fixedColor":"#8a2be2","mode":"shades"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","fillOpacity":80,"gradientMode":"hue","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineWidth":1,"scaleDistribution":{"type":"linear"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"}]},"unit":"currencyBRL"},"overrides":[]},"gridPos":{"h":6,"w":15,"x":9,"y":16},"id":3,"options":{"barRadius":0,"barWidth":0.97,"fullHighlight":true,"groupWidth":0.7,"legend":{"calcs":[],"displayMode":"list","placement":"right","showLegend":false},"orientation":"auto","showValue":"auto","stacking":"none","tooltip":{"mode":"single","sort":"none"},"xField":"quarter","xTickLabelRotation":0,"xTickLabelSpacing":0},"pluginVersion":"11.1.3","targets":[{"dataset":"u766359255_rod","datasource":{"type":"mysql","uid":"fduch7oogb280e"},"editorMode":"code","format":"table","rawQuery":true,"rawSql":"WITH\r\n  QuarterlyCategorySpend AS (\r\n    SELECT\r\n      A.category,\r\n      CONCAT('T', QUARTER(A.date), '-', YEAR(A.date)) AS quarter,\r\n      SUM(A.value) AS total_spent,\r\n      ROW_NUMBER() OVER (\r\n        PARTITION BY\r\n          YEAR(A.date),\r\n          QUARTER(A.date)\r\n        ORDER BY\r\n          SUM(A.value) DESC\r\n      ) AS rank\r\n    FROM\r\n      bk_tb_transactions A\r\n      join bk_tb_categories D on A.category = D.id\r\n    where\r\n      D.internal is false\r\n      and D.positive is false\r\n    GROUP BY\r\n      A.category,\r\n      YEAR(A.date),\r\n      QUARTER(A.date)\r\n  )\r\nSELECT\r\n  B.quarter,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 1 THEN C.name\r\n    END\r\n  ) AS cat1,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 1 THEN B.total_spent\r\n    END\r\n  ) AS cat_value1,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 2 THEN C.name\r\n    END\r\n  ) AS cat2,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 2 THEN B.total_spent\r\n    END\r\n  ) AS cat_value2,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 3 THEN C.name\r\n    END\r\n  ) AS cat3,\r\n  MAX(\r\n    CASE\r\n      WHEN B.rank = 3 THEN B.total_spent\r\n    END\r\n  ) AS cat_value3\r\nFROM\r\n  QuarterlyCategorySpend B\r\n  join bk_tb_categories C on B.category = C.id\r\nWHERE\r\n  B.rank <= 3\r\nGROUP BY\r\n  B.quarter\r\nORDER BY\r\n  B.quarter;","refId":"A","sql":{"columns":[{"parameters":[],"type":"function"}],"groupBy":[{"property":{"type":"string"},"type":"groupBy"}],"limit":50}}],"title":"3º gastos Trimestre","type":"barchart"}],"refresh":"","schemaVersion":39,"tags":[],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{},"timezone":"browser","title":"[OKR1] Controle dos gastos","uid":"adwbaua9onabkb","version":6,"weekStart":""}}